<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Resume - Phillip Marvyn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        /* Custom Styles */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font */
        }
        /* Style for filter tags */
        .filter-tag {
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .filter-tag.selected {
            /* Existing styles for selected tags */
            transform: scale(1.05);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        /* Style for selected section filters */
        .filter-section-btn.selected {
             background-color: #4f46e5; /* indigo-600 */
             color: white;
             border-color: #a5b4fc; /* indigo-300 */
             font-weight: 600; /* semibold */
        }
         .filter-section-btn { /* Base styles for section buttons */
             cursor: pointer;
             transition: all 0.2s ease-in-out;
             border: 1px solid transparent; /* Add a border for consistency */
         }
         .filter-section-btn:hover:not(.selected) {
              background-color: #e0e7ff; /* indigo-100 */
              color: #4338ca; /* indigo-800 */
         }


        /* Simple animation for experience items */
        .experience-item {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Style for publication list */
        .publication-list li {
            margin-bottom: 0.75rem; /* Add space between publications */
            padding-left: 1.5rem;
            position: relative;
        }
        .publication-list li::before {
            content: "\f0f6"; /* Font Awesome document icon */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            left: 0;
            top: 0.1em; /* Adjust vertical alignment */
            color: #4f46e5; /* Indigo */
        }

        /* Sticky sidebar styling */
        .sticky-sidebar {
            position: sticky;
            top: 1rem; /* Adjust based on desired spacing from top */
            max-height: calc(100vh - 2rem); /* Max height of the sidebar, accounting for top/bottom padding */
            overflow-y: auto; /* Add scroll if content exceeds max height */
        }

    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-indigo-600 mb-2">Phillip Marvyn</h1>
            <p class="text-xl text-gray-600">Data Engineer</p>
            <div class="mt-4 space-x-4">
                <a href="" class="text-indigo-500 hover:text-indigo-700"><i class="fas fa-phone"></i> +1 519-802-8108</a>
                <a href="mailto:pmmarvyn@gmail.com" class="text-indigo-500 hover:text-indigo-700"><i class="fas fa-envelope"></i> pmmarvyn@gmail.com</a>
                <a href="https://github.com/pmmarvyn" class="text-indigo-500 hover:text-indigo-700" aria-label="GitHub Profile"><i class="fab fa-github"></i></a>
                <a href="https://www.linkedin.com/in/pmmarvyn/" class="text-indigo-500 hover:text-indigo-700" aria-label="LinkedIn Profile"><i class="fab fa-linkedin"></i></a>
                 <a href="https://www.kaggle.com/bulkiestmist" class="text-indigo-500 hover:text-indigo-700" aria-label="Kaggle Profile"><i class="fab fa-kaggle"></i></a>
            </div>
        </header>

        <section class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-2xl font-semibold mb-4 border-b pb-3 text-indigo-600">Profile</h2>
            <p class="text-gray-700 leading-relaxed">
                Passionate about harnessing cutting-edge technologies to solve real-world problems. I use OpenAI and Gemini APIs daily to automate coding, extract and generate data, and streamline workflows. With a foundation in quantitative science, I bring a strong analytical mindset to every project. I'm especially driven by innovations in machine learning, AI, and human health. Currently seeking exciting opportunities to grow as a Data Engineer and make meaningful impact through data.
            </p>
        </section>
        <div class="flex flex-col md:flex-row gap-8">

            <aside class="w-full md:w-1/4 lg:w-1/5">
                <div class="bg-white p-4 rounded-lg shadow-md sticky-sidebar">
                    <h2 class="text-xl font-semibold mb-4 border-b pb-2">Filters</h2>

                    <div class="mb-6">
                         <h3 class="text-lg font-medium text-gray-800 mb-3">Show Section</h3>
                         <div id="section-filters" class="flex flex-wrap gap-2">
                             <button class="filter-section-btn bg-gray-200 text-gray-700 text-sm font-medium px-3 py-1 rounded-full selected" data-section="all">All</button>
                             <button class="filter-section-btn bg-gray-200 text-gray-700 text-sm font-medium px-3 py-1 rounded-full" data-section="work">Work</button>
                             <button class="filter-section-btn bg-gray-200 text-gray-700 text-sm font-medium px-3 py-1 rounded-full" data-section="education">Education</button>
                             <button class="filter-section-btn bg-gray-200 text-gray-700 text-sm font-medium px-3 py-1 rounded-full" data-section="publications">Publications</button>
                         </div>
                    </div>

                    <div id="work-experience-filters"> <div class="mb-6">
                            <label for="search-input" class="block text-sm font-medium text-gray-700 mb-1">Search Work Experience/Projects</label>
                            <input type="text" id="search-input" placeholder="Search keywords..." class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                        </div>

                        <div>
                            <h3 class="text-lg font-medium text-gray-800 mb-3">Filter Related Projects by Tag</h3>
                            <div id="tag-filters" class="flex flex-wrap gap-2">
                                <span class="text-gray-500 text-sm">Loading tags...</span>
                            </div>
                             <button id="clear-filters-btn" class="mt-4 text-sm text-indigo-600 hover:text-indigo-800 disabled:opacity-50 disabled:cursor-not-allowed" disabled>Clear Work Filters</button>
                        </div>
                    </div>
                </div>
            </aside>

            <main class="w-full md:w-3/4 lg:w-4/5">
                <section id="work-experience-section" class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h2 class="text-2xl font-semibold mb-6 border-b pb-3 text-indigo-600">Work Experience</h2>
                    <div id="experience-list" class="space-y-6">
                        <p id="no-results-message" class="text-center text-gray-500 hidden">No work experiences or projects match the current filters.</p>
                    </div>
                </section>

                <section id="education-section" class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h2 class="text-2xl font-semibold mb-4 border-b pb-3 text-indigo-600">Education</h2>
                    <div class="space-y-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">PhD – Biochemistry - Protein Engineering for CAR-T cells</h3>
                            <p class="text-md text-indigo-700">McMaster University</p>
                            <p class="text-sm text-gray-500">2016 - 2021</p>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">MSc - Lipid Metabolism</h3>
                            <p class="text-md text-indigo-700">University of Waterloo</p>
                            <p class="text-sm text-gray-500">2013 - 2015</p>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">BSc - Kinesiology</h3>
                            <p class="text-md text-indigo-700">University of Waterloo</p>
                            <p class="text-sm text-gray-500">2008 - 2012</p>
                        </div>
                    </div>
                </section>

                <section class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h2 class="text-2xl font-semibold mb-4 border-b pb-3 text-indigo-600">Skills</h2>
                    <div class="flex flex-wrap gap-2">
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Python</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Data Analysis</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Data Engineering</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">LLM</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">OpenAI API</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Prompt Engineering</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Automation</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Web Scraping</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Google Colab</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Google Sheets API</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Chrome Extensions</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Jinja2</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Leadership</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Mentorship</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Management</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Hiring & Training</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Data Governance</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Scientific Research</span>
                        <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">Biochemistry</span>
                        </div>
                </section>

                <section class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h2 class="text-2xl font-semibold mb-4 border-b pb-3 text-indigo-600">Interests</h2>
                    <div class="flex flex-wrap gap-2">
                         <span class="bg-gray-100 text-gray-500 text-sm font-medium px-3 py-1 rounded-full">Mentoring/Teaching</span>
                         <span class="bg-gray-100 text-gray-500 text-sm font-medium px-3 py-1 rounded-full">LLM Technologies</span>
                         <span class="bg-gray-100 text-gray-500 text-sm font-medium px-3 py-1 rounded-full">Bioinformatics</span>
                         <span class="bg-gray-100 text-gray-500 text-sm font-medium px-3 py-1 rounded-full">Single cell RNA Seq</span>
                         <span class="bg-gray-100 text-gray-500 text-sm font-medium px-3 py-1 rounded-full">Proteomics</span>
                         <span class="bg-gray-100 text-gray-500 text-sm font-medium px-3 py-1 rounded-full">3D Modeling/Printing</span>
                         <span class="bg-gray-100 text-gray-500 text-sm font-medium px-3 py-1 rounded-full">Hiking</span>
                         <span class="bg-gray-100 text-gray-500 text-sm font-medium px-3 py-1 rounded-full">Camping</span>
                    </div>
                </section>

                <section id="publications-section" class="bg-white p-6 rounded-lg shadow-md">
                    <h2 class="text-2xl font-semibold mb-4 border-b pb-3 text-indigo-600">Selected Publications & Patents</h2>
                    <ul class="list-none publication-list text-gray-700 leading-relaxed">
                        <li>Marvyn PM, Bramson J. Chimeric costimulatory receptors and methods and uses thereof. International Patent Number WO2021051195A1. September 16, 2020.</li>
                        <li>Fernandes MF, Aristizabal-Henao JJ, Marvyn PM, M’Hiri I, Wiens M, Hoang M, Sebastian M, Nachbar R, St-Pierre P, De Silva K, Wood GA, Joseph JW, Doucette CA; Marette A, Stark KD, Duncan RE. Renal tubule specific Atgl deletion links kidney fat metabolism to glucagon-like peptide 1 and insulin secretion independent of renal inflammation or lipotoxicity. Molecular Metabolism. January 24, 2024.</li>
                        <li>Bradley RM, Mardian EB, Bloemberg D, Aristizabal Henao JJ, Mitchell AS, Marvyn PM, Moes KA, Stark KD, Quadrilatero J, Duncan RE. Mice Deficient in lysophosphatidic acid acyltransferase delta (Lpaatδ)/acylglycerophosphate acyltransferase 4 (Agpat4) Have Impaired Learning and Memory. Molecular Cell Biology. October 27, 2017.</li>
                         <li><a href="https://pubmed.ncbi.nlm.nih.gov/?term=marvyn+pm"><i class="fas fa-external-link-alt mr-1"></i>All Publications</a></li>
                    </ul>
                </section>

            </main>
        </div>
    </div>

    <script>
        // --- Resume Data ---
        // Array of experience objects. Updated with Phillip Marvyn's data and added projects.
        const experiences = [
            {
                title: 'Senior Data Manager @Zebricks',
                company: 'Lumerate',
                location: 'Remote',
                years: 'March 2025 – Present',
                description: 'Led and mentored 4 data analysts, fostering a collaborative and high-performing environment. Defined team objectives, set performance expectations, and conducted regular performance reviews to ensure alignment with organizational goals. Recruited, onboarded, and trained new data team members, building a skilled and efficient workforce. Facilitated cross-functional collaboration with engineering, product, and business teams to ensure data-driven decision-making. Implemented best practices for data governance, quality, and documentation across the data team. Drove the adoption of new data technologies and methodologies to enhance data capabilities and efficiency.',
                tags: ['Management', 'Hiring', 'Training', 'Collaboration'],
                projects: [ // Projects for this role
                    {
                        title: 'KPI Management',
                        description: 'Designed and implemented KPI\'s enabling data-driven performance evaluation and resource allocation.',
                        tags: ['KPIs', 'Reporting', 'Project Management']
                    },
                    {
                        title: 'Data Team Hiring',
                        description: 'Experience with Breezy for candidate review, tracking and collaboration with HR Team',
                        tags: ['Breezy', 'Hiring', 'Management', 'Collaboration']
                    }
                ]
            },
            {
                title: 'Data Analyst',
                company: 'Lumerate',
                location: 'Remote',
                years: 'March 2023 – March 2025',
                description: 'As the primary data specialist on a new development project, I mentored and supported new data team members, providing guidance and feedback on their projects. Developed semi-automated Python scripts for news publishing, integrating third-party software, Google Sheets, and internal tools. Reduced task time 80%, from 80 hours/week to 10 hours/week. Developed and optimized LLM prompts for extracting data, summarizing key information, and classifying text, utilizing Jinja2 templates to streamline data input. Leveraged the OpenAI API for bulk processing of files, streamlining data extraction, generation, manipulation, and formatting. Took the initiative to identify and alleviate team member pain points by developing Chrome extensions to automate and streamline workflows, saving 30 minutes per day per team member. Developed Python scripts in Google Colab to extract and process data from multiple web sources, including handling and analyzing PDF documents. Performed data scraping, cleaning, and quality assurance to maintain a high-quality organizational database.',
                tags: ['Python', 'Automation', 'Google Sheets API', 'OpenAI API','Gemini API'],
                projects: [ // Projects for this role
                    {
                        title: 'Automated News Publishing System',
                        description: 'Developed Python scripts to automate the extraction, processing, and publishing of news content from various web sources by integrating with various third-party apps and API\'s, Google Sheets API\'s, and internal publishing platforms, resulting in an 87% reduction in manual effort from 80 hrs/wk to 10hrs/wk',
                        tags: ['Python', 'Automation', 'API Integration', 'Google Sheets API', 'Web Scraping', 'Data Processing', 'Selenium', 'Workflow Optimization']
                    },
                    {
                        title: 'LLM-Powered Data Extraction and Classification',
                        description: 'Designed and fine-tuned LLM prompts using Jinja2 templates and the OpenAI API for efficient extraction of structured data, summarization of key information, and classification of text documents from diverse sources.',
                        tags: ['Prompt Engineering', 'OpenAI API', 'Gemini API', 'Jinja2', 'Data Extraction', 'Text Classification']
                    },
                     {
                        title: 'Workflow Streamlining Chrome Extensions',
                        description: 'Identified repetitive tasks and developed custom Chrome extensions to automate browser-based workflows for the team, saving approximately 30 minutes per team member per day and improving overall efficiency.',
                        tags: ['Chrome Extension', 'Automation', 'JavaScript', 'Workflow Optimization']
                    },
                     {
                        title: 'Web Data Extraction and PDF Analysis Pipeline',
                        description: 'Created Python scripts within Google Colab to systematically extract data from multiple web sources and process information embedded within PDF documents using OpenAI API with Pydantic Schema\'s, establishing a robust pipeline for data acquisition and analysis.',
                        tags: ['Python', 'Google Colab', 'Web Scraping', 'PDF Processing', 'Data Extraction', 'Pydantic']
                    }
                ]
            },
            {
                title: 'Data Analyst',
                company: 'Alvea Bio',
                location: 'Remote',
                years: 'Jan 2022 – Jan 2023',
                description: 'Designed and implemented databases to support vaccine development efforts, enabling quick identification of vaccine formulations, dosing strategies, technologies, trial status, and regulatory approvals. Provided expert advice on scientific and technological developments in vaccine research. Conducted ad-hoc research on diverse topics, ranging from vaccine formulations to document submissions.',
                tags: ['Vaccine Development','Biotech', 'Research'],
                projects: [ // Projects for this role
                    {
                        title: 'Vaccine Development Database System',
                        description: 'Designed and built a database to track and manage critical data related to vaccine development, including formulations, clinical trial progress, regulatory submissions, and technological approaches, facilitating efficient data retrieval and analysis.',
                        tags: ['Google Sheets']
                    },
                     {
                        title: 'Scientific Literature Review and Synthesis',
                        description: 'Conducted in-depth research and synthesized findings from scientific literature on emerging vaccine technologies and development strategies to inform internal decision-making and provide expert scientific advice.',
                        tags: ['Research', 'Biotech']
                    }
                ]
            }
        ];

        // --- DOM Elements ---
        const workExperienceSection = document.getElementById('work-experience-section');
        const educationSection = document.getElementById('education-section');
        const publicationsSection = document.getElementById('publications-section');
        const searchInput = document.getElementById('search-input');
        const tagFiltersContainer = document.getElementById('tag-filters');
        const experienceListContainer = document.getElementById('experience-list');
        const noResultsMessage = document.getElementById('no-results-message');
        const clearFiltersBtn = document.getElementById('clear-filters-btn');
        const sectionFiltersContainer = document.getElementById('section-filters');
        const workExperienceFiltersContainer = document.getElementById('work-experience-filters'); // Container for search/tag filters

        // --- State ---
        let selectedTags = new Set(); // Use a Set for efficient add/delete/check
        let searchTerm = '';
        // Initialize to show all sections (mutual exclusion means only one "state" is active)
        let selectedSection = 'all'; // Can be 'all', 'work', 'education', or 'publications'


        // --- Functions ---

        /**
         * Extracts unique tags from the experiences (main tags and project tags) data.
         * @returns {string[]} An array of unique tags, sorted alphabetically.
         */
        function getUniqueTags() {
            const allTags = experiences.flatMap(exp => {
                // Collect tags from the main experience
                let tags = exp.tags || [];
                // Collect tags from each project within the experience
                if (exp.projects) {
                    exp.projects.forEach(project => {
                        if (project.tags) {
                            tags = tags.concat(project.tags);
                        }
                    });
                }
                return tags;
            });
            // Added case-insensitive sorting
            return [...new Set(allTags)].sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()));
        }

        /**
         * Renders the filter tag buttons in the sidebar.
         */
        function renderTagFilters() {
            const uniqueTags = getUniqueTags();
            tagFiltersContainer.innerHTML = ''; // Clear loading message or previous tags

            if (uniqueTags.length === 0) {
                 tagFiltersContainer.innerHTML = '<span class="text-gray-500 text-sm">No tags available.</span>';
                 return;
            }

            uniqueTags.forEach(tag => {
                const tagButton = document.createElement('button');
                tagButton.textContent = tag;
                tagButton.dataset.tag = tag; // Store tag name in data attribute
                // Added rounded-full for pill shape
                tagButton.className = 'filter-tag bg-gray-200 text-gray-700 text-sm font-medium px-3 py-1 rounded-full hover:bg-indigo-100 hover:text-indigo-800';
                // Add 'selected' class if this tag is currently in the selectedTags Set
                if (selectedTags.has(tag)) {
                     tagButton.classList.add('selected', 'bg-indigo-600', 'text-white', 'ring-2', 'ring-indigo-300');
                     tagButton.classList.remove('bg-gray-200', 'text-gray-700');
                }
                tagButton.addEventListener('click', handleTagClick);
                tagFiltersContainer.appendChild(tagButton);
            });
        }

        /**
         * Handles clicking on a tag filter button. Toggles selection state and appearance.
         * @param {Event} event - The click event object.
         */
        function handleTagClick(event) {
            const button = event.target;
            const tag = button.dataset.tag;

            // Toggle tag selection in the Set
            if (selectedTags.has(tag)) {
                selectedTags.delete(tag);
                // Style for deselected tag
                button.classList.remove('selected', 'bg-indigo-600', 'text-white', 'ring-2', 'ring-indigo-300');
                button.classList.add('bg-gray-200', 'text-gray-700');
            } else {
                selectedTags.add(tag);
                // Style for selected tag
                button.classList.add('selected', 'bg-indigo-600', 'text-white', 'ring-2', 'ring-indigo-300');
                button.classList.remove('bg-gray-200', 'text-gray-700');
            }
            // Update the displayed experiences after tag selection changes
            renderExperiences();
            updateClearButtonState();
        }

        /**
         * Handles clicking on a section filter button. Switches section visibility (mutually exclusive).
         * @param {Event} event - The click event object.
         */
        function handleSectionClick(event) {
            const button = event.target;
            const section = button.dataset.section; // 'all', 'work', 'education', or 'publications'

            // Update the selectedSection state
            selectedSection = section;

            // Update button styles: Remove 'selected' from all, add to the clicked one(s)
            const sectionButtons = sectionFiltersContainer.querySelectorAll('.filter-section-btn');
            sectionButtons.forEach(btn => {
                btn.classList.remove('selected');
            });

            // Add 'selected' class based on the new state
            if (selectedSection === 'all') {
                 sectionFiltersContainer.querySelector('[data-section="all"]').classList.add('selected');
            } else {
                 button.classList.add('selected');
            }


            // Render sections based on the new state
            renderSections();
            // Update clear button state (only affects work filters)
            updateClearButtonState();
        }


        /**
         * Filters experiences based on the search term (case-insensitive) and selected tags (using OR logic).
         * An experience is considered a match if its main details OR any of its projects match the filters.
         * @returns {object[]} An array of filtered experience objects.
         */
        function filterExperiences() {
            const lowerCaseSearchTerm = searchTerm.toLowerCase().trim();

            return experiences.filter(exp => {
                // Check if the main experience details match the search term or selected tags
                const mainDetailsMatch = (lowerCaseSearchTerm === '' ||
                                         exp.title.toLowerCase().includes(lowerCaseSearchTerm) ||
                                         exp.company.toLowerCase().includes(lowerCaseSearchTerm) ||
                                         exp.description.toLowerCase().includes(lowerCaseSearchTerm)) &&
                                         (selectedTags.size === 0 ||
                                         [...selectedTags].some(tag => exp.tags.map(t => t.toLowerCase()).includes(tag.toLowerCase())));

                // Check if any projects within the experience match the search term or selected tags
                const projectsMatch = exp.projects && exp.projects.some(project => {
                    const projectSearchMatch = lowerCaseSearchTerm === '' ||
                                               project.title.toLowerCase().includes(lowerCaseSearchTerm) ||
                                               project.description.toLowerCase().includes(lowerCaseSearchTerm);

                    const projectTagsMatch = selectedTags.size === 0 ||
                                             (project.tags && [...selectedTags].some(tag => project.tags.map(t => t.toLowerCase()).includes(tag.toLowerCase())));

                    return projectSearchMatch && projectTagsMatch;
                });

                // The experience is included if its main details match OR if any of its projects match
                return mainDetailsMatch || projectsMatch;
            });
        }

        /**
         * Renders the filtered work experiences and their matching projects into the experience list container.
         * Handles the display of the "no results" message.
         * This function only affects the content *within* the work experience section.
         */
        function renderExperiences() {
             // This function is only responsible for the list *content*
             // The visibility of the section header/container is handled by renderSections()

             // Clear previous list content
             experienceListContainer.innerHTML = '';

             // Hide/show work experience filters based on selectedSection
             // This logic is handled by renderSections, no need to duplicate here.
             // The check below is removed as it was causing the issue.
             /*
             if (selectedSection !== 'work' && selectedSection !== 'all') {
                 workExperienceFiltersContainer.classList.add('hidden');
                 noResultsMessage.classList.add('hidden'); // Hide no results message if section is hidden
                 return;
             }
             */

             // If the work section is visible, ensure filters are shown
             // This is also handled by renderSections.
             // workExperienceFiltersContainer.classList.remove('hidden');


             const filteredExperiences = filterExperiences(); // Get experiences where either the main entry or a project matches

             if (filteredExperiences.length === 0) {
                 // If no experiences or projects match the filters at all
                 noResultsMessage.classList.remove('hidden');
             } else {
                 noResultsMessage.classList.add('hidden'); // Hide no results message if there are results

                 filteredExperiences.forEach(exp => {
                     const div = document.createElement('div');
                     // Styling for each experience item
                     div.className = 'experience-item border-l-4 border-indigo-500 pl-4 mb-6';

                     // Header: Title and Years
                     const header = document.createElement('div');
                     header.className = 'flex flex-col sm:flex-row justify-between items-start mb-1'; // Responsive layout
                     header.innerHTML = `
                         <h3 class="text-xl font-semibold text-gray-900 mb-1 sm:mb-0">${exp.title}</h3>
                         <span class="text-sm text-gray-500 whitespace-nowrap sm:ml-4">${exp.years}</span>
                     `;
                     div.appendChild(header);

                     // SubHeader: Company and Location
                     const subHeader = document.createElement('div');
                     subHeader.className = 'text-md font-medium text-indigo-700 mb-2';
                     subHeader.textContent = `${exp.company}${exp.location ? ' | ' + exp.location : ''}`; // Only add location if available
                     div.appendChild(subHeader);

                     // Description Paragraph - Hide if any tag filters are selected
                     if (selectedTags.size === 0) {
                         const description = document.createElement('p');
                         description.className = 'text-gray-600 mb-3';
                         description.textContent = exp.description;
                         div.appendChild(description);
                     }


                     // Tags Container for main experience
                     const tagsDiv = document.createElement('div');
                     tagsDiv.className = 'flex flex-wrap gap-2 mb-4'; // Added margin-bottom
                     if (exp.tags) {
                        exp.tags.forEach(tag => {
                            const span = document.createElement('span');
                            span.className = 'bg-gray-100 text-gray-600 text-xs font-medium px-2.5 py-0.5 rounded-full border border-gray-300';
                            if (selectedTags.has(tag)) {
                                span.classList.add('bg-indigo-100', 'text-indigo-800', 'border-indigo-300', 'font-semibold');
                            }
                            span.textContent = tag;
                            tagsDiv.appendChild(span);
                        });
                     }
                     div.appendChild(tagsDiv);


                     // --- Render Projects ---
                     if (exp.projects && exp.projects.length > 0) {
                         const projectsContainer = document.createElement('div');
                         projectsContainer.className = 'mt-4 pt-4 border-t border-gray-200 space-y-4'; // Styling for project section

                         const projectsTitle = document.createElement('h4');
                         projectsTitle.className = 'text-lg font-semibold text-gray-800';
                         projectsTitle.textContent = 'Related Projects:';
                         projectsContainer.appendChild(projectsTitle);

                         // Filter projects based on current search term and selected tags
                         const filteredProjects = exp.projects.filter(project => {
                             const lowerCaseSearchTerm = searchTerm.toLowerCase().trim();

                             // Project search match
                             const projectSearchMatch = lowerCaseSearchTerm === '' ||
                                                        project.title.toLowerCase().includes(lowerCaseSearchTerm) ||
                                                        project.description.toLowerCase().includes(lowerCaseSearchTerm);

                             // Project tag match (OR logic)
                             const projectTagsMatch = selectedTags.size === 0 ||
                                                      (project.tags && [...selectedTags].some(tag => project.tags.map(t => t.toLowerCase()).includes(tag.toLowerCase())));

                             return projectSearchMatch && projectTagsMatch;
                         });

                         if (filteredProjects.length > 0) {
                             filteredProjects.forEach(project => {
                                 const projectDiv = document.createElement('div');
                                 projectDiv.className = 'pl-4 border-l-2 border-blue-400'; // Styling for individual project

                                 const projectHeader = document.createElement('div');
                                 projectHeader.className = 'flex flex-col sm:flex-row justify-between items-start mb-1';
                                 projectHeader.innerHTML = `
                                     <h5 class="text-md font-semibold text-gray-800 mb-1 sm:mb-0">${project.title}</h5>
                                 `;
                                 projectDiv.appendChild(projectHeader);

                                 const projectDescription = document.createElement('p');
                                 projectDescription.className = 'text-gray-600 text-sm mb-2';
                                 projectDescription.textContent = project.description;
                                 projectDiv.appendChild(projectDescription);

                                 const projectTagsDiv = document.createElement('div');
                                 projectTagsDiv.className = 'flex flex-wrap gap-1';
                                 if (project.tags) {
                                     project.tags.forEach(tag => {
                                         const span = document.createElement('span');
                                         span.className = 'bg-blue-100 text-blue-800 text-xs font-medium px-2 py-0.5 rounded-full';
                                          // Highlight project tags if they are currently selected in the sidebar filters
                                          if (selectedTags.has(tag)) {
                                              span.classList.add('bg-indigo-100', 'text-indigo-800', 'border-indigo-300', 'font-semibold');
                                          }
                                         span.textContent = tag;
                                         projectTagsDiv.appendChild(span);
                                     });
                                 }
                                 projectDiv.appendChild(projectTagsDiv);

                                 projectsContainer.appendChild(projectDiv);
                             });
                              div.appendChild(projectsContainer); // Append projects container to the main experience div

                         } else {
                              // Show a message if the job experience is shown but has no matching projects
                              const noProjectsMessage = document.createElement('p');
                              noProjectsMessage.className = 'text-gray-500 text-sm italic';
                              noProjectsMessage.textContent = 'No projects under this experience match the filters.';
                              projectsContainer.appendChild(noProjectsMessage);
                              div.appendChild(projectsContainer); // Append projects container even if empty
                         }
                     } // End of Render Projects

                     // Append the complete experience item div to the list container
                     experienceListContainer.appendChild(div);
                 });
             }
        }

        /**
         * Renders the main content sections based on the selectedSection state.
         * This function shows/hides the entire Work, Education, and Publications sections.
         */
        function renderSections() {
             // Hide all sections initially
             workExperienceSection.classList.add('hidden');
             educationSection.classList.add('hidden');
             publicationsSection.classList.add('hidden');

             // Hide/show work experience filters based on selectedSection
             if (selectedSection === 'work' || selectedSection === 'all') {
                 workExperienceFiltersContainer.classList.remove('hidden');
             } else {
                 workExperienceFiltersContainer.classList.add('hidden');
             }


             // Show the selected section(s)
             if (selectedSection === 'all') {
                 workExperienceSection.classList.remove('hidden');
                 educationSection.classList.remove('hidden');
                 publicationsSection.classList.remove('hidden');
                 // When 'All' is selected, make sure work experiences are rendered based on their filters
                 renderExperiences();

             } else if (selectedSection === 'work') {
                 workExperienceSection.classList.remove('hidden');
                 // When 'Work' is selected, render experiences based on their filters
                 renderExperiences();

             } else if (selectedSection === 'education') {
                 educationSection.classList.remove('hidden');

             } else if (selectedSection === 'publications') {
                 publicationsSection.classList.remove('hidden');
             }
        }


        /**
         * Updates the enabled/disabled state and appearance of the 'Clear Filters' button
         * based on whether any work experience filters (search or tags) are active.
         */
         function updateClearButtonState() {
             // The "Clear Work Filters" button is enabled if there is a search term OR selected tags
             const hasActiveWorkFilters = selectedTags.size > 0 || searchTerm.trim() !== '';
             clearFiltersBtn.disabled = !hasActiveWorkFilters;
             clearFiltersBtn.classList.toggle('opacity-50', !hasActiveWorkFilters);
             clearFiltersBtn.classList.toggle('cursor-not-allowed', !hasActiveWorkFilters);
         }

        /**
         * Clears the work experience search input, removes all selected tags,
         * resets tag button styles, and re-renders the work experiences.
         * Does NOT affect section filters.
         */
         function clearWorkFilters() {
             // Clear search input visually and in state
             searchInput.value = '';
             searchTerm = '';

             // Clear selected tags state
             selectedTags.clear();

             // Reset tag button visual styles
             const tagButtons = tagFiltersContainer.querySelectorAll('.filter-tag');
             tagButtons.forEach(button => {
                 button.classList.remove('selected', 'bg-indigo-600', 'text-white', 'ring-2', 'ring-indigo-300');
                 button.classList.add('bg-gray-200', 'text-gray-700');
             });

             // Re-render experiences with no work filters and update button state
             renderExperiences();
             updateClearButtonState();
         }

        // --- Event Listeners ---
        // Listen for input in the search bar to filter dynamically
        searchInput.addEventListener('input', (event) => {
            searchTerm = event.target.value; // Update search term state
             // Only re-render work experiences if the work section is currently visible
             if (selectedSection === 'work' || selectedSection === 'all') {
                renderExperiences();
             }
            updateClearButtonState(); // Update clear button status
        });

        // Listen for clicks on the 'Clear Work Filters' button
        clearFiltersBtn.addEventListener('click', clearWorkFilters);

        // Listen for clicks on the section filter buttons
        sectionFiltersContainer.querySelectorAll('.filter-section-btn').forEach(button => {
            button.addEventListener('click', handleSectionClick);
        });


        // --- Initial Setup ---
        // Run these functions once the DOM is fully loaded and ready
        document.addEventListener('DOMContentLoaded', () => {
            renderTagFilters(); // Populate tag filter buttons based on data
            // Initial rendering: Show all sections and render experiences within the work section
            // Ensure 'All' button is selected initially in HTML
            renderSections(); // Render the initial state based on selectedSection ('all' by default)
            updateClearButtonState(); // Set the initial state of the work clear button
        });

    </script>

</body>
</html>
